Support stacking for account management as well as for session setup.

--- Linux-PAM-0.80/modules/pam_mkhomedir/pam_mkhomedir.c.orig	2005-08-10 00:21:09 +0000
+++ Linux-PAM-0.80/modules/pam_mkhomedir/pam_mkhomedir.c	2005-08-10 00:43:23 +0000
@@ -553,6 +553,18 @@ int pam_sm_close_session(pam_handle_t * 
 }
 
 #ifdef PAM_STATIC
+#define pam_sm_acct_mgmt pam_sm_open_session
+#elif defined(__linux__) && defined(__ELF__)
+__asm__(".globl pam_sm_acct_mgmt; pam_sm_acct_mgmt = pam_sm_open_session");
+#else
+PAM_EXTERN int pam_sm_acct_mgmt(pam_handle_t *pamh, int flags,
+	int argc, const char **argv)
+{
+	return pam_sm_open_session(pamh, flags, argc, argv);
+}
+#endif
+
+#ifdef PAM_STATIC
 
 /* static module data */
 struct pam_module _pam_mkhomedir_modstruct =
@@ -560,7 +572,7 @@ struct pam_module _pam_mkhomedir_modstru
    "pam_mkhomedir",
    NULL,
    NULL,
-   NULL,
+   pam_sm_acct_mgmt,
    pam_sm_open_session,
    pam_sm_close_session,
    NULL,
