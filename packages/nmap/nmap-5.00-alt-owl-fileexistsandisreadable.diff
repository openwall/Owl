--- nmap-5.00/nmap.cc.orig	2009-06-24 21:35:54.000000000 +0000
+++ nmap-5.00/nmap.cc	2009-07-16 08:08:53.000000000 +0000
@@ -2821,10 +2821,13 @@
 
   struct stat st;
 
-  if (stat(pathname_buf, &st) == -1)
-    status = 0;
-  else if (access(pathname_buf, R_OK) != -1)
-    status = S_ISDIR(st.st_mode) ? 2 : 1;
+  if (access(pathname_buf, R_OK) == 0 && stat(pathname_buf, &st) == 0) {
+      if (S_ISREG(st.st_mode)) {
+      	status = 1;
+      } else if (S_ISDIR(st.st_mode)) {
+	status = 2;
+      }
+  }
 
   free(pathname_buf);
   return status;
