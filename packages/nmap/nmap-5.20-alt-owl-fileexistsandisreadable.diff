--- nmap-5.20/nmap.cc.orig	2009-12-24 21:32:06.000000000 +0000
+++ nmap-5.20/nmap.cc	2010-01-22 14:25:17.000000000 +0000
@@ -2730,10 +2730,13 @@ int fileexistsandisreadable(const char *
 
   struct stat st;
 
-  if (stat(pathname_buf, &st) == -1)
-    status = 0;
-  else if (access(pathname_buf, R_OK) != -1)
-    status = S_ISDIR(st.st_mode) ? 2 : 1;
+  if (access(pathname_buf, R_OK) == 0 && stat(pathname_buf, &st) == 0) {
+      if (S_ISREG(st.st_mode)) {
+      	status = 1;
+      } else if (S_ISDIR(st.st_mode)) {
+	status = 2;
+      }
+  }
 
   free(pathname_buf);
   return status;
