diff -ur shadow-4.0.0.orig/configure shadow-4.0.0/configure
--- shadow-4.0.0.orig/configure	Sat Oct  6 23:28:28 2001
+++ shadow-4.0.0/configure	Sun Nov 11 04:52:24 2001
@@ -12498,19 +12498,7 @@
 }
 
 # Create a (secure) tmp directory for tmp files.
-: ${TMPDIR=/tmp}
-{
-  tmp=`(umask 077 && mktemp -d -q "$TMPDIR/csXXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
-}  ||
-{
-  tmp=$TMPDIR/cs$$-$RANDOM
-  (umask 077 && mkdir $tmp)
-} ||
-{
-   echo "$me: cannot create a temporary directory in $TMPDIR" >&2
-   { (exit 1); exit 1; }
-}
+tmp="`mktemp -dt cs.XXXXXXXXXX`" || exit 1
 
 EOF
 
diff -ur shadow-4.0.0.orig/src/useradd.c shadow-4.0.0/src/useradd.c
--- shadow-4.0.0.orig/src/useradd.c	Fri Sep  7 19:12:54 2001
+++ shadow-4.0.0/src/useradd.c	Sun Nov 11 04:49:29 2001
@@ -474,11 +474,7 @@
 	 * Create a temporary file to copy the new output to.
 	 */
 
-#ifdef HAVE_MKSTEMP
 	if ((ofd = mkstemp (new_file)) == -1) {
-#else
-	if ((ofd = mktemp (new_file)) == -1) {
-#endif
 		fprintf(stderr, _("%s: cannot create new defaults file\n"),
  			Prog);
  		return -1;
