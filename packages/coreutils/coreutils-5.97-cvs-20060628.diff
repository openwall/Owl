Index: .prev-version
===================================================================
RCS file: /sources/coreutils/coreutils/.prev-version,v
retrieving revision 1.44.2.8
retrieving revision 1.44.2.9
diff -u -p -a -r1.44.2.8 -r1.44.2.9
--- .prev-version	22 May 2006 06:36:52 -0000	1.44.2.8
+++ .prev-version	24 Jun 2006 06:34:36 -0000	1.44.2.9
@@ -1 +1 @@
-5.96
+5.97
Index: ChangeLog
===================================================================
RCS file: /sources/coreutils/coreutils/ChangeLog,v
retrieving revision 1.1508.2.50
retrieving revision 1.1508.2.54
diff -u -p -a -r1.1508.2.50 -r1.1508.2.54
--- ChangeLog	22 Jun 2006 12:52:36 -0000	1.1508.2.50
+++ ChangeLog	28 Jun 2006 09:53:33 -0000	1.1508.2.54
@@ -1,7 +1,44 @@
-2006-06-22  Jim Meyering  <jim@meyering.net>
+2006-06-28  Bob Proulx  <bob@proulx.com>  (tiny change)
+
+	* Version 5.98.
+
+	* tests/mv/i-link-no: Work around HP-UX /bin/sh tracing problem
+	(set -x when VERBOSE=yes) when stderr is redirected before stdout
+	causing shell tracing of the stdout redirection to be written to
+	the stderr file.  Avoid problem and test failure on HP-UX by
+	redirecting stderr last.
+
+2006-06-27  Jim Meyering  <jim@meyering.net>
+
+	* tests/misc/cat-proc: Try to avoid any spurious numeric
+	differences in frequently-changing /proc/cpuinfo.
+	Reported by Nelson Beebe.
+
+2006-06-26  Jim Meyering  <jim@meyering.net>
+
+	Import this test suite fix from the trunk.
+
+	2006-03-03  Jim Meyering  <jim@meyering.net>
+
+	Don't fail when run from an environment with SHELL not a Bourne
+	shell, e.g. `env SHELL=/bin/csh make check' would fail this test.
+	* tests/dircolors/simple: Invoke each non-failing test with -b.
+	Reported by Michael Stone.
+
+2006-06-25  Jim Meyering  <jim@meyering.net>
+
+	Avoid a segfault from `rm -rf /some/dir' when that directory
+	is in an unusual state (where open(".",...) fails with ENOENT),.
+	* src/remove.c (remove_cwd_entries): If opendir fails, ensure
+	there is no way to call readdir with a NULL pointer.
+	Reported by Marc Lehmann in <http://bugs.debian.org/375333>.
+
+2006-06-24  Jim Meyering  <jim@meyering.net>
 
 	* Version 5.97.
 
+2006-06-22  Jim Meyering  <jim@meyering.net>
+
 	* src/tee.c (tee_files): Rename from tee, to avoid conflict with
 	the function in glibc's <fcntl.h>.  Reported by Andreas Schwab.
 
Index: src/remove.c
===================================================================
RCS file: /sources/coreutils/coreutils/src/remove.c,v
retrieving revision 1.132.2.2
retrieving revision 1.132.2.3
diff -u -p -a -r1.132.2.2 -r1.132.2.3
--- src/remove.c	6 May 2006 21:12:06 -0000	1.132.2.2
+++ src/remove.c	25 Jun 2006 19:41:05 -0000	1.132.2.3
@@ -1,5 +1,5 @@
 /* remove.c -- core functions for removing files and directories
-   Copyright (C) 88, 90, 91, 1994-2005 Free Software Foundation, Inc.
+   Copyright (C) 88, 90, 91, 1994-2006 Free Software Foundation, Inc.
 
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
@@ -881,12 +881,9 @@ remove_cwd_entries (Dirstack_state *ds, 
 
   if (dirp == NULL)
     {
-      if (errno != ENOENT || !x->ignore_missing_files)
-	{
-	  error (0, errno, _("cannot open directory %s"),
-		 quote (full_filename (".")));
-	  return RM_ERROR;
-	}
+      error (0, errno, _("cannot open directory %s"),
+	     quote (full_filename (".")));
+      return RM_ERROR;
     }
 
   while (1)
Index: tests/dircolors/simple
===================================================================
RCS file: /sources/coreutils/coreutils/tests/dircolors/simple,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -p -a -r1.7 -r1.7.2.1
--- tests/dircolors/simple	19 Oct 2005 07:30:48 -0000	1.7
+++ tests/dircolors/simple	26 Jun 2006 17:57:00 -0000	1.7.2.1
@@ -23,9 +23,14 @@ my @Tests =
      ['a', {IN => {k => "exec\n"}},
       {ERR => "dircolors: k:1: invalid line;  missing second token\n"},
       {EXIT => 1}],
-     ['quote', {IN => "exec 'echo Hello;:'\n"},
+     ['quote', '-b', {IN => "exec 'echo Hello;:'\n"},
       {OUT => "LS_COLORS='ex='\\''echo Hello;\\:'\\'':';\n"
       . "export LS_COLORS\n"}],
+     ['other-wr', '-b', {IN => "owt 40;33\n"},
+      {OUT => "LS_COLORS='tw=40;33:';\nexport LS_COLORS\n"}],
+
+     # CAREFUL: always specify the -b option, unless explicitly testing
+     # for csh syntax output.
     );
 
 my $save_temps = $ENV{DEBUG};
Index: tests/misc/cat-proc
===================================================================
RCS file: /sources/coreutils/coreutils/tests/misc/cat-proc,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -u -p -a -r1.1.2.2 -r1.1.2.3
--- tests/misc/cat-proc	10 Jun 2006 08:20:54 -0000	1.1.2.2
+++ tests/misc/cat-proc	27 Jun 2006 18:44:39 -0000	1.1.2.3
@@ -32,9 +32,10 @@ fail=0
 
 # Yes, parts of /proc/cpuinfo might change between cat runs.
 # If that happens, consider choosing a file that's less likely to change,
-# or just filter out the changing lines.
-cat -E $f | tr -d '$' > out || fail=1
-cat    $f | tr -d '$' > exp || fail=1
+# or just filter out the changing lines.  The sed filter should help
+# to avoid any spurious numeric differences.
+cat -E $f | sed 's/[0-9][0-9]*/D/g' | tr -d '$' > out || fail=1
+cat    $f | sed 's/[0-9][0-9]*/D/g' | tr -d '$' > exp || fail=1
 
 cmp out exp || fail=1
 test $fail = 1 && diff out exp 2> /dev/null
Index: tests/mv/i-link-no
===================================================================
RCS file: /sources/coreutils/coreutils/tests/mv/i-link-no,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -p -a -r1.7 -r1.7.2.1
--- tests/mv/i-link-no	3 Jul 2005 16:54:37 -0000	1.7
+++ tests/mv/i-link-no	28 Jun 2006 09:53:34 -0000	1.7.2.1
@@ -31,7 +31,7 @@ fi
 
 fail=0
 
-mv --reply=no a/bar a/foo b 2> err > out || fail=1
+mv --reply=no a/bar a/foo b > out 2> err || fail=1
 cat <<EOF > exp
 EOF
 
