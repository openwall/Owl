diff -urp procmail-3.22.orig/src/mailfold.c procmail-3.22/src/mailfold.c
--- procmail-3.22.orig/src/mailfold.c	Tue Sep 11 04:58:34 2001
+++ procmail-3.22/src/mailfold.c	Fri Oct 28 13:22:56 2005
@@ -120,13 +120,20 @@ jin:	while(part&&(i=rwrite(s,source,BLKS
       }
 writefin:
      i=type!=ft_PIPE&&fsync(s)&&errno!=EINVAL;	  /* EINVAL => wasn't a file */
+     if ((i&&!len?-1:len)&&lasttell>=0)
+      { int serrno=errno;
+	if(ftruncate(s,lasttell)) lasttell= -1;
+	SETerrno(serrno);
+      }
+     else
+	lasttell= -1;
      if(ft_lock(type))
       { int serrno=errno;		       /* save any error information */
 	if(fdunlock())
 	   nlog("Kernel-unlock failed\n");
 	SETerrno(serrno);
       }
-     i=rclose(s)||i;
+     i=rclose(s)||i; /* if this fails, we should truncate, but it's too late */
    }			   /* return an error even if nothing was to be sent */
   return i&&!len?-1:len;
 }
@@ -237,7 +244,7 @@ dumpf:	 { switch(errno)
 #endif
 	      default:writeerr(buf);
 	    }
-	   if(lasttell>=0&&!truncate(boxname,lasttell)&&(logopened||verbose))
+	   if(lasttell>=0&&(logopened||verbose))
 	      nlog("Truncated file to former size\n");	    /* undo garbage */
 ret0:	   return 0;
 	 }
