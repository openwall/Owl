--- modutils-2.3.17/man/depmod.8.systemmap	Fri Aug 11 08:35:17 2000
+++ modutils-2.3.17/man/depmod.8	Thu Sep 28 20:02:31 2000
@@ -9,11 +9,11 @@
 depmod \- handle dependency descriptions for loadable kernel modules
 .SH SYNOPSIS
 .B depmod
-\-[aA] [\-enqsvVr]
+\-[aA] [\-einqsvVr]
 [\-C\ configfile] [\-F\ kernelsyms] [\-b\ basedirectory] [forced_version]
 .br
 .B depmod
-[\-enqsv] [\-F\ kernelsyms] module1.o module2.o ...
+[\-einqsv] [\-F\ kernelsyms] module1.o module2.o ...
 .SH OPTIONS
 .TP
 .I \-a
@@ -29,6 +29,19 @@
 .I \-e
 Show all the unresolved symbol for each module.
 .TP
+.I \-i
+Ignore symbol versions when building dependency list. This is useful
+especially if you use a versioned kernel and want to build dependencies
+against a System.map file (see the
+.I \-F
+option). Use this with care, because if the symbol versions don't match,
+.B modprobe
+or
+.B insmod
+won't be able to load the modules even though
+.B depmod
+succeeds.
+.TP
 .I \-n
 Write the dependency file on stdout instead of in the
 .B /lib/modules
@@ -113,7 +126,14 @@
 .B must
 use a copy of the
 .I /proc/ksyms
-output, since that file contains the symbol versions of the kernel symbols.
+output, since that file contains the symbol versions of the kernel symbols,
+unless you use the
+.I \-i
+option.
+For compatibility,
+.I "\-m kernelsyms"
+is identical to 
+.I "\-F kernelsyms"
 .SH DESCRIPTION
 The
 .B depmod
--- modutils-2.3.17/depmod/depmod.c.systemmap	Fri Sep 22 23:13:54 2000
+++ modutils-2.3.17/depmod/depmod.c	Thu Sep 28 20:02:31 2000
@@ -114,6 +114,7 @@
 static SYMBOL *symavail;
 static SYMBOL *maxsyms;
 static LIST_SYMBOL *chunk;
+static int ignore_symbol_versions;
 
 static int quiet;	/* Don't print errors */
 static int showerror;	/* Shows undefined symbols */
@@ -808,7 +809,9 @@
 		{"errsyms", 0, 0, 'e'},
 		{"filesyms", 1, 0, 'F'},
 		{"help", 0, 0, 'h'},
+		{"ignore-versions", 0, 0, 'i'},
 		{"show", 0, 0, 'n'},
+		{"system-map", 1, 0, 'm'}, /* backward compatibility, same as 'F' */
 		{"quiet", 0, 0, 'q'},
 		{"syslog", 0, 0, 's'},
 		{"verbose", 0, 0, 'v'},
@@ -819,7 +822,7 @@
 
 	error_file = "depmod";
 
-	while ((o = getopt_long(argc, argv, "aAb:C:eF:hnqsvVr",
+	while ((o = getopt_long(argc, argv, "aAb:C:eF:him:nqsvVr",
 				&long_opts[0], NULL)) != EOF) {
 		switch (o) {
 		case 'A':
@@ -842,11 +845,16 @@
 			return 0;
 			break;
 
+		case 'i':
+			ignore_symbol_versions = 1;
+			break;
+
 		case 'C':
 			conf_file = optarg;
 			break;
 
 		case 'F':
+		case 'm':
 			file_syms = optarg;
 			break;
 
