diff -urN screen-3.9.10.orig/Makefile.in screen-3.9.10/Makefile.in
--- screen-3.9.10.orig/Makefile.in	Tue Sep  4 18:26:21 2001
+++ screen-3.9.10/Makefile.in	Sun May 19 06:03:42 2002
@@ -52,12 +52,12 @@
 
 CFILES=	screen.c ansi.c fileio.c mark.c misc.c resize.c socket.c \
 	search.c tty.c term.c window.c utmp.c loadav.c putenv.c help.c \
-	termcap.c input.c attacher.c pty.c process.c display.c comm.c \
+	termcap.c input.c attacher.c appl_userpass.c pty.c process.c display.c comm.c \
 	kmapdef.c acls.c braille.c braille_tsi.c logfile.c layer.c \
 	sched.c teln.c nethack.c utf8.c
 OFILES=	screen.o ansi.o fileio.o mark.o misc.o resize.o socket.o \
 	search.o tty.o term.o window.o utmp.o loadav.o putenv.o help.o \
-	termcap.o input.o attacher.o pty.o process.o display.o comm.o \
+	termcap.o input.o attacher.o appl_userpass.o pty.o process.o display.o comm.o \
 	kmapdef.o acls.o braille.o braille_tsi.o logfile.o layer.o \
 	sched.o teln.o nethack.o utf8.o
 
diff -urN screen-3.9.10.orig/_pam_userpass.h screen-3.9.10/_pam_userpass.h
--- screen-3.9.10.orig/_pam_userpass.h	Thu Jan  1 03:00:00 1970
+++ screen-3.9.10/_pam_userpass.h	Sun May 19 06:03:42 2002
@@ -0,0 +1,12 @@
+#ifndef __PAM_USERPASS_H
+#define __PAM_USERPASS_H
+
+#define USERPASS_AGENT_ID		"userpass"
+#define USERPASS_AGENT_ID_LENGTH	8
+
+#define USERPASS_USER_MASK		0x03
+#define USERPASS_USER_REQUIRED		1
+#define USERPASS_USER_KNOWN		2
+#define USERPASS_USER_FIXED		3
+
+#endif
diff -urN screen-3.9.10.orig/appl_userpass.c screen-3.9.10/appl_userpass.c
--- screen-3.9.10.orig/appl_userpass.c	Thu Jan  1 03:00:00 1970
+++ screen-3.9.10/appl_userpass.c	Sun May 19 06:03:42 2002
@@ -0,0 +1,59 @@
+#include <string.h>
+#include <stdlib.h>
+
+#include <security/pam_appl.h>
+#include <security/pam_client.h>
+
+#ifndef PAM_BP_RCONTROL
+/* Linux-PAM prior to 0.74 */
+#define PAM_BP_RCONTROL	PAM_BP_CONTROL
+#define PAM_BP_WDATA	PAM_BP_DATA
+#define PAM_BP_RDATA	PAM_BP_DATA
+#endif
+
+#include "_pam_userpass.h"
+#include "pam_userpass.h"
+
+int pam_userpass_conv(int num_msg, const struct pam_message **msg,
+	struct pam_response **resp, void *appdata_ptr)
+{
+	pam_userpass_t *userpass = (pam_userpass_t *)appdata_ptr;
+	pamc_bp_t prompt;
+	const char *input;
+	char *output;
+	char flags;
+
+	if (num_msg != 1 || msg[0]->msg_style != PAM_BINARY_PROMPT)
+		return PAM_CONV_ERR;
+
+	prompt = (pamc_bp_t)msg[0]->msg;
+	input = PAM_BP_RDATA(prompt);
+
+	if (PAM_BP_RCONTROL(prompt) != PAM_BPC_SELECT ||
+	    strncmp(input, USERPASS_AGENT_ID "/", USERPASS_AGENT_ID_LENGTH + 1))
+		return PAM_CONV_ERR;
+
+	flags = input[USERPASS_AGENT_ID_LENGTH + 1];
+	input += USERPASS_AGENT_ID_LENGTH + 1 + 1;
+
+	if ((flags & USERPASS_USER_MASK) == USERPASS_USER_FIXED &&
+	    strcmp(input, userpass->user))
+		return PAM_CONV_AGAIN;
+
+	if (!(*resp = malloc(sizeof(struct pam_response))))
+		return PAM_CONV_ERR;
+
+	prompt = NULL;
+	PAM_BP_RENEW(&prompt, PAM_BPC_DONE,
+		strlen(userpass->user) + 1 + strlen(userpass->pass));
+	output = PAM_BP_WDATA(prompt);
+
+	strcpy(output, userpass->user);
+	output += strlen(output) + 1;
+	memcpy(output, userpass->pass, strlen(userpass->pass));
+
+	(*resp)[0].resp_retcode = 0;
+	(*resp)[0].resp = (char *)prompt;
+
+	return PAM_SUCCESS;
+}
diff -urN screen-3.9.10.orig/attacher.c screen-3.9.10/attacher.c
--- screen-3.9.10.orig/attacher.c	Sat Apr 28 17:26:42 2001
+++ screen-3.9.10/attacher.c	Sun May 19 06:59:28 2002
@@ -33,6 +33,9 @@
 #include "screen.h"
 #include "extern.h"
 
+#include <security/pam_appl.h>
+#include "pam_userpass.h"
+
 #include <pwd.h>
 
 static sigret_t AttacherSigInt __P(SIGPROTOARG);
@@ -52,7 +55,7 @@
 static sigret_t AttachSigCont __P(SIGPROTOARG);
 #endif
 
-extern int real_uid, real_gid, eff_uid, eff_gid;
+extern int real_uid, real_gid, eff_uid, eff_gid, init_eff_gid;
 extern char *SockName, *SockMatch, SockPath[];
 extern struct passwd *ppp;
 extern char *attach_tty, *attach_term, *LoginName, *preselect;
@@ -720,40 +723,19 @@
     }
 }				/* LockTerminal */
 
+static pam_userpass_t userpass;
+static struct pam_conv conv = {
+    &pam_userpass_conv,
+    &userpass
+};
+
 /* -- original copyright by Luigi Cannelloni 1985 (luigi@faui70.UUCP) -- */
 static void
 screen_builtin_lck()
 {
   char fullname[100], *cp1, message[100 + 100];
-  char *pass, mypass[9];
-
-  pass = ppp->pw_passwd;
-  if (pass == 0 || *pass == 0)
-    {
-      if ((pass = getpass("Key:   ")))
-        {
-          strncpy(mypass, pass, 8);
-          mypass[8] = 0;
-          if (*mypass == 0)
-            return;
-          if ((pass = getpass("Again: ")))
-            {
-              if (strcmp(mypass, pass))
-                {
-                  fprintf(stderr, "Passwords don't match.\007\n");
-                  sleep(2);
-                  return;
-                }
-            }
-        }
-      if (pass == 0)
-        {
-          fprintf(stderr, "Getpass error.\007\n");
-          sleep(2);
-          return;
-        }
-      pass = 0;
-    }
+  int status;
+  pam_handle_t *pamh = NULL;
 
   debug("screen_builtin_lck looking in gcos field\n");
   strncpy(fullname, ppp->pw_gecos, sizeof(fullname) - 9);
@@ -782,16 +764,32 @@
           AttacherFinit(SIGARG);
           /* NOTREACHED */
         }
-      if (pass)
-        {
-          if (!strncmp(crypt(cp1, pass), pass, strlen(pass)))
-            break;
-        }
-      else
-        {
-          if (!strcmp(cp1, mypass))
-            break;
-        }
+
+      userpass.user = ppp->pw_name;
+      userpass.pass = cp1;
+
+      status = pam_start("screen", ppp->pw_name, &conv, &pamh);
+
+      if (status == PAM_SUCCESS)
+	{
+	  /* Let the PAM modules make use of our SGID privileges. */
+	  xsetegid(init_eff_gid);
+	  if ((status = pam_authenticate(pamh, 0)) != PAM_SUCCESS)
+            {
+	       xsetegid(real_gid);
+	       pam_end(pamh, status);
+	       continue;
+	    }
+	  xsetegid(real_gid);
+
+	  status = pam_end(pamh, PAM_SUCCESS);
+	  if (status == PAM_SUCCESS)
+	    {
+	       memset(cp1, 0, strlen(cp1));
+	       userpass.pass = NULL;
+	       break;
+	    }
+	}
       debug("screen_builtin_lck: NO!!!!!\n");
     }
   debug("password ok.\n");
diff -urN screen-3.9.10.orig/configure.in screen-3.9.10/configure.in
--- screen-3.9.10.orig/configure.in	Thu May 17 21:00:19 2001
+++ screen-3.9.10/configure.in	Sun May 19 06:06:26 2002
@@ -1080,6 +1080,8 @@
 )
 fi
 
+AC_CHECK_LIB(pam, pam_start, LIBS="$LIBS -lpam -ldl", AC_MSG_ERROR(PAM required!))
+
 dnl AC_CHECK_HEADER(shadow.h, AC_DEFINE(SHADOWPW))
 AC_CHECKING(getspnam)
 AC_TRY_LINK([#include <shadow.h>], [getspnam("x");],AC_DEFINE(SHADOWPW))
diff -urN screen-3.9.10.orig/pam_userpass.h screen-3.9.10/pam_userpass.h
--- screen-3.9.10.orig/pam_userpass.h	Thu Jan  1 03:00:00 1970
+++ screen-3.9.10/pam_userpass.h	Tue Apr  2 00:11:26 2002
@@ -0,0 +1,14 @@
+#ifndef _PAM_USERPASS_H
+#define _PAM_USERPASS_H
+
+#include <security/pam_appl.h>
+
+typedef struct {
+	const char *user;
+	const char *pass;
+} pam_userpass_t;
+
+extern int pam_userpass_conv(int num_msg, const struct pam_message **msg,
+	struct pam_response **resp, void *appdata_ptr);
+
+#endif
diff -urN screen-3.9.10.orig/screen.c screen-3.9.10/screen.c
--- screen-3.9.10.orig/screen.c	Tue Sep  4 17:14:51 2001
+++ screen-3.9.10/screen.c	Sun May 19 06:57:53 2002
@@ -203,7 +203,7 @@
 
 char HostName[MAXSTR];
 int MasterPid;
-int real_uid, real_gid, eff_uid, eff_gid;
+int real_uid, real_gid, eff_uid, eff_gid, init_eff_gid;
 int default_startup;
 int ZombieKey_destroy, ZombieKey_resurrect;
 char *preselect = NULL;		/* only used in Attach() */
@@ -729,7 +729,7 @@
   real_uid = getuid();
   real_gid = getgid();
   eff_uid = geteuid();
-  eff_gid = getegid();
+  init_eff_gid = eff_gid = getegid();
   if (eff_uid != real_uid)
     {		
       /* if running with s-bit, we must install a special signal
