diff -urpN bind-9.3.5-P2.owl9/lib/dns/message.c bind-9.3.5-P2/lib/dns/message.c
--- bind-9.3.5-P2.owl9/lib/dns/message.c	2008-07-28 23:47:49 +0000
+++ bind-9.3.5-P2/lib/dns/message.c	2016-10-21 03:15:39 +0000
@@ -2539,9 +2539,9 @@ dns_message_setopt(dns_message_t *msg, d
 	return (ISC_R_SUCCESS);
 
  cleanup:
+	dns_rdataset_disassociate(opt);
 	dns_message_puttemprdataset(msg, &opt);
 	return (result);
-
 }
 
 dns_rdataset_t *
diff -urpN bind-9.3.5-P2.owl9/lib/dns/resolver.c bind-9.3.5-P2/lib/dns/resolver.c
--- bind-9.3.5-P2.owl9/lib/dns/resolver.c	2008-07-24 05:00:46 +0000
+++ bind-9.3.5-P2/lib/dns/resolver.c	2016-10-21 03:15:39 +0000
@@ -901,23 +901,20 @@ resquery_senddone(isc_task_t *task, isc_
 
 static inline isc_result_t
 fctx_addopt(dns_message_t *message, dns_resolver_t *res) {
-	dns_rdataset_t *rdataset;
-	dns_rdatalist_t *rdatalist;
-	dns_rdata_t *rdata;
+	dns_rdataset_t *rdataset = NULL;
+	dns_rdatalist_t *rdatalist = NULL;
+	dns_rdata_t *rdata = NULL;
 	isc_result_t result;
 
-	rdatalist = NULL;
 	result = dns_message_gettemprdatalist(message, &rdatalist);
 	if (result != ISC_R_SUCCESS)
 		return (result);
-	rdata = NULL;
 	result = dns_message_gettemprdata(message, &rdata);
 	if (result != ISC_R_SUCCESS)
-		return (result);
-	rdataset = NULL;
+		goto cleanup;
 	result = dns_message_gettemprdataset(message, &rdataset);
 	if (result != ISC_R_SUCCESS)
-		return (result);
+		goto cleanup;
 	dns_rdataset_init(rdataset);
 
 	rdatalist->type = dns_rdatatype_opt;
@@ -932,7 +929,6 @@ fctx_addopt(dns_message_t *message, dns_
 	 * Set EXTENDED-RCODE, VERSION, and Z to 0, and the DO bit to 1.
 	 */
 	rdatalist->ttl = DNS_MESSAGEEXTFLAG_DO;
-
 	/*
 	 * No EDNS options.
 	 */
@@ -947,6 +943,15 @@ fctx_addopt(dns_message_t *message, dns_
 	RUNTIME_CHECK(dns_rdatalist_tordataset(rdatalist, rdataset) == ISC_R_SUCCESS);
 
 	return (dns_message_setopt(message, rdataset));
+
+ cleanup:
+	if (rdata != NULL)
+		dns_message_puttemprdata(message, &rdata);
+	if (rdataset != NULL)
+		dns_message_puttemprdataset(message, &rdataset);
+	if (rdatalist != NULL)
+		dns_message_puttemprdatalist(message, &rdatalist);
+	return (result);
 }
 
 static inline void
