diff -upk.orig libtool-1.5.18.orig/demo/Makefile.am libtool-1.5.18/demo/Makefile.am
--- libtool-1.5.18.orig/demo/Makefile.am	2004-09-19 12:04:52 +0000
+++ libtool-1.5.18/demo/Makefile.am	2005-04-26 13:36:23 +0000
@@ -135,7 +135,8 @@ libhell2_la_LDFLAGS = -no-undefined -rpa
 libhell2_la_DEPENDENCIES = libhell0.a
 EXTRA_PROGRAMS = hell0
 hell0_SOURCES = main.c
-hell0_LDADD = libhell1.la libhell2.la $(LIBM)
+hell0_LDADD = libhell1.la libhell2.la
+hell0_LDFLAGS = $(LIBM) -L. -lhell0
 
 # 'hell0' in EXTRA_PROGRAMS gets translated to 'hell0.exe'; but we
 # must explicitly list the wrapper script 'hell0'.  (bin_PROGRAMS
diff -upk.orig libtool-1.5.18.orig/libtool.m4 libtool-1.5.18/libtool.m4
--- libtool-1.5.18.orig/libtool.m4	2005-05-15 13:41:23 +0000
+++ libtool-1.5.18/libtool.m4	2005-05-26 11:29:06 +0000
@@ -2678,7 +2678,7 @@ _LT_AC_TAGVAR(hardcode_minus_L, $1)=no
 _LT_AC_TAGVAR(hardcode_automatic, $1)=no
 _LT_AC_TAGVAR(module_cmds, $1)=
 _LT_AC_TAGVAR(module_expsym_cmds, $1)=
-_LT_AC_TAGVAR(link_all_deplibs, $1)=unknown
+_LT_AC_TAGVAR(link_all_deplibs, $1)=$link_all_deplibs
 _LT_AC_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
 _LT_AC_TAGVAR(no_undefined_flag, $1)=
 _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
@@ -3770,7 +3770,7 @@ _LT_AC_TAGVAR(hardcode_minus_L, $1)=no
 _LT_AC_TAGVAR(hardcode_automatic, $1)=no
 _LT_AC_TAGVAR(module_cmds, $1)=
 _LT_AC_TAGVAR(module_expsym_cmds, $1)=
-_LT_AC_TAGVAR(link_all_deplibs, $1)=unknown
+_LT_AC_TAGVAR(link_all_deplibs, $1)=$link_all_deplibs
 _LT_AC_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
 _LT_AC_TAGVAR(no_undefined_flag, $1)=
 _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
@@ -5188,6 +5188,9 @@ ifelse([$1],[CXX],[
   cygwin* | mingw*)
     _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]] /s/.* \([[^ ]]*\)/\1 DATA/;/^.* __nm__/s/^.* __nm__\([[^ ]]*\) [[^ ]]*/\1 DATA/;/^I /d;/^[[AITW]] /s/.* //'\'' | sort | uniq > $export_symbols'
   ;;
+  linux*)
+    _LT_AC_TAGVAR(link_all_deplibs, $1)=no
+  ;;
   *)
     _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
   ;;
@@ -5365,6 +5368,7 @@ EOF
   $echo "local: *; };" >> $output_objdir/$libname.ver~
 	  $CC -shared'"$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
 	fi
+	_LT_AC_TAGVAR(link_all_deplibs, $1)=no
       else
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
       fi
diff -upk.orig libtool-1.5.18.orig/ltmain.in libtool-1.5.18/ltmain.in
--- libtool-1.5.18.orig/ltmain.in	2005-05-04 19:13:00 +0000
+++ libtool-1.5.18/ltmain.in	2005-05-26 11:29:06 +0000
@@ -1994,7 +1994,10 @@ EOF
 	case $pass in
 	dlopen) libs="$dlfiles" ;;
 	dlpreopen) libs="$dlprefiles" ;;
-	link) libs="$deplibs %DEPLIBS% $dependency_libs" ;;
+	link)
+	  libs="$deplibs %DEPLIBS%"
+	  test "X$link_all_deplibs" = Xno || libs="$libs $dependency_libs"
+	  ;;
 	esac
       fi
       if test "$pass" = dlopen; then
